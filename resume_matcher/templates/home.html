{% extends 'base.html' %}
{% block content %}
<h1>Smart Resume Analyzer & Job Matcher</h1>
<hr>
<h2>Upload Your Resume (PDF or Text)</h2>
<form method="post" enctype="multipart/form-data" class="mb-4">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit" class="btn btn-primary">Upload</button>
</form>

{% if user.is_authenticated %}
    <h3>Your Uploaded Resumes</h3>
    <ul class="list-group">
        {% for resume, matches in resume_matches %}
        <li class="list-group-item">
            {{ resume.uploaded_at }} - 
            {% if resume.file %}
                <a href="{{ resume.file.url }}" target="_blank">Download</a>
            {% else %}
                No file uploaded
            {% endif %}
            {% if resume.skills %}
                <div class="mt-2">
                    <strong>Extracted Skills:</strong>
                    <span>{{ resume.skills }}</span>
                </div>
            {% endif %}
            {% if resume.parsed_text %}
                <div class="mt-2">
                    <strong>Extracted Text:</strong>
                    <pre style="white-space: pre-wrap;">{{ resume.parsed_text|truncatechars:1000 }}</pre>
                </div>
            {% endif %}
            {% if matches %}
                <div class="mt-2">
                    <strong>Top Job Matches (TF-IDF + Skills):</strong>
                    <ul class="list-group mt-2">
                        {% for match in matches %}
                            <li class="list-group-item">
                                <strong>{{ match.job.title }}</strong> at {{ match.job.company }}<br>
                                <em>TF-IDF Score:</em> {{ match.tfidf_score }}<br>
                                <em>Skill Match Score:</em> {{ match.skill_score }}<br>
                                {% if match.matched_skills %}
                                    <em>Matched Skills:</em> {{ match.matched_skills|join:", " }}<br>
                                {% endif %}
                                <em>Description:</em> {{ match.job.description|truncatechars:300 }}
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            {% endif %}
        </li>
    {% empty %}
        <li class="list-group-item">No resumes uploaded yet.</li>
    {% endfor %}
</ul>
{% else %}
    <div class="alert alert-info mt-4">
        Please <a href="{% url 'login' %}">log in</a> or <a href="{% url 'register' %}">register</a> to upload and view your resumes.
    </div>
{% endif %}
{% endblock %}